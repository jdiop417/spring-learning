## MITM 为什么需要安装证书？
### TLS 是怎样确认目标主机身份的了
来看一下 TLS 握手的具体流程：
1. 客户端通过 SNI，明文告知服务端正在访问 example.com，请提供相应的证书。
2. 服务端确认自己拥有 example.com 的证书，向客户端提供自己的服务器证书和所有中级证书。
3. 客户端收到证书，确认证书的 Common Name（或者 SAN 字段）字段包含 example.com。
4. 确认验证该证书的证书链可被根证书库所信任。

现在我们已经能确认服务器提供的证书，确实是 example.com 的一个真实可信的证书了，唯一还需要确认的是，服务端拥有该证书的私钥。

5. 客户端随机生成一段内容，使用服务器证书的公钥加密后发给服务端。服务端用私钥解密后可通过该内容计算出后续传输阶段的对称加密密钥，称作会话密钥

如果服务端没有该证书的私钥，那么则不可能计算出正确的会话密钥，也就无法继续和客户端的通讯。

### 参考
* Surge 官方中文指引：理解 Surge 原理
